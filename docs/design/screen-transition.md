# 画面遷移図

本アプリケーションはシングルページアプリケーション (SPA) であり、ページ遷移はありませんが、LIFF初期化と状態によって表示内容が変化します。

```mermaid
stateDiagram-v2
    [*] --> LIFF初期化

    state "LIFF初期化" as LiffInit {
        [*] --> 初期化中
        初期化中 --> ログイン確認: init成功
        初期化中 --> LIFF初期化エラー: init失敗
        ログイン確認 --> ログイン済み: isLoggedIn=true
        ログイン確認 --> 未ログイン: isLoggedIn=false
        ログイン済み --> プロフィール取得
        プロフィール取得 --> [*]: userId取得完了
        未ログイン --> [*]: userId未設定
    }

    LIFF初期化 --> 初期ロード: 初期化完了
    LIFF初期化 --> エラー表示: 初期化エラー

    state "買い物リスト画面 (S01)" as MainScreen {
        初期ロード --> リスト表示: データ取得成功
        初期ロード --> エラー表示: データ取得失敗

        state "リスト表示" as List {
            [*] --> 待機状態
            待機状態 --> アイテム追加中: 追加ボタン押下
            アイテム追加中 --> 待機状態: 追加完了
            
            待機状態 --> 更新中: チェックボックス押下
            更新中 --> 待機状態: 更新完了

            待機状態 --> 削除中: 削除ボタン押下
            削除中 --> 待機状態: 削除完了

            待機状態 --> 自動更新: 5秒経過
            自動更新 --> 待機状態: 最新データ反映
        }
    }
```

## 状態説明

| 状態 | 説明 |
| :---: | :--- |
| LIFF初期化 | LIFF SDKの初期化を行い、LINEログイン状態を確認する |
| 初期化中 | `liff.init()` を実行中 |
| ログイン確認 | LINEログイン状態を確認 (`liff.isLoggedIn()`) |
| ログイン済み | LINEにログイン済み。プロフィール情報を取得可能 |
| 未ログイン | LINEに未ログイン。LINE User ID なしでAPIリクエストを送信 |
| プロフィール取得 | `liff.getProfile()` でユーザー情報を取得 |
| LIFF初期化エラー | LIFF初期化に失敗。エラーメッセージを表示 |
| 初期ロード | サーバーからリストデータを取得 |
| リスト表示 | 買い物リストを表示し、ユーザー操作を受け付ける |
| 待機状態 | ユーザーの操作を待機 |
| アイテム追加中 | 新しいアイテムをサーバーに送信中 |
| 更新中 | アイテムの完了状態をサーバーに送信中 |
| 削除中 | アイテムの削除リクエストをサーバーに送信中 |
| 自動更新 | 5秒ごとのポーリングでサーバーから最新データを取得 |
| エラー表示 | エラーメッセージを表示 |
